<main class="configuracion">
  <header class="configuracion__cabecera">
    <h1 class="configuracion__titulo">Configuración</h1>
    <p class="configuracion__subtitulo">Personaliza tu experiencia en Cofira</p>
  </header>

  <section class="configuracion__contenido">
    <nav class="configuracion__menu">
      <button
        (click)="cambiarSeccion('general')"
        [class.configuracion__menu-item--activo]="seccionActiva() === 'general'"
        class="configuracion__menu-item"
        type="button">
        <svg aria-hidden="true" class="configuracion__menu-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>General</span>
      </button>

      <button
        (click)="cambiarSeccion('notificaciones')"
        [class.configuracion__menu-item--activo]="seccionActiva() === 'notificaciones'"
        class="configuracion__menu-item"
        type="button">
        <svg aria-hidden="true" class="configuracion__menu-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Notificaciones</span>
      </button>

      <button
        (click)="cambiarSeccion('privacidad')"
        [class.configuracion__menu-item--activo]="seccionActiva() === 'privacidad'"
        class="configuracion__menu-item"
        type="button">
        <svg aria-hidden="true" class="configuracion__menu-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Privacidad</span>
      </button>

      <button
        (click)="cambiarSeccion('suscripcion')"
        [class.configuracion__menu-item--activo]="seccionActiva() === 'suscripcion'"
        class="configuracion__menu-item"
        type="button">
        <svg aria-hidden="true" class="configuracion__menu-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Suscripción</span>
      </button>

      <button
        (click)="cambiarSeccion('cuenta')"
        [class.configuracion__menu-item--activo]="seccionActiva() === 'cuenta'"
        class="configuracion__menu-item"
        type="button">
        <svg aria-hidden="true" class="configuracion__menu-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Cuenta</span>
      </button>
    </nav>

    <article class="configuracion__panel">
      @switch (seccionActiva()) {
        @case ('general') {
          <section class="configuracion__seccion">
            <h2 class="configuracion__seccion-titulo">Preferencias Generales</h2>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Idioma y Región</legend>

              <article class="configuracion__opcion">
                <label class="configuracion__label" for="idioma">Idioma de la aplicación</label>
                <select
                  (change)="actualizarPreferencia('idiomaSeleccionado', $any($event.target).value)"
                  [value]="preferencias().idiomaSeleccionado"
                  class="configuracion__select"
                  id="idioma">
                  @for (idioma of idiomas; track idioma.codigo) {
                    <option [value]="idioma.codigo">{{ idioma.nombre }}</option>
                  }
                </select>
              </article>
            </fieldset>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Unidades de Medida</legend>

              <article class="configuracion__opcion">
                <label class="configuracion__label" for="unidadesPeso">Unidades de peso</label>
                <select
                  (change)="actualizarPreferencia('unidadesPeso', $any($event.target).value)"
                  [value]="preferencias().unidadesPeso"
                  class="configuracion__select"
                  id="unidadesPeso">
                  @for (unidad of unidadesPesoOpciones; track unidad.codigo) {
                    <option [value]="unidad.codigo">{{ unidad.nombre }}</option>
                  }
                </select>
              </article>

              <article class="configuracion__opcion">
                <label class="configuracion__label" for="unidadesAltura">Unidades de altura</label>
                <select
                  (change)="actualizarPreferencia('unidadesAltura', $any($event.target).value)"
                  [value]="preferencias().unidadesAltura"
                  class="configuracion__select"
                  id="unidadesAltura">
                  @for (unidad of unidadesAlturaOpciones; track unidad.codigo) {
                    <option [value]="unidad.codigo">{{ unidad.nombre }}</option>
                  }
                </select>
              </article>
            </fieldset>
          </section>
        }

        @case ('notificaciones') {
          <section class="configuracion__seccion">
            <h2 class="configuracion__seccion-titulo">Notificaciones</h2>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Canales de Comunicación</legend>

              <article class="configuracion__toggle-item">
                <hgroup class="configuracion__toggle-info">
                  <h3 class="configuracion__toggle-titulo">Notificaciones por email</h3>
                  <p class="configuracion__toggle-descripcion">Recibe actualizaciones y consejos en tu correo</p>
                </hgroup>
                <button
                  (click)="togglePreferencia('notificacionesEmail')"
                  [class.configuracion__toggle--activo]="preferencias().notificacionesEmail"
                  class="configuracion__toggle"
                  type="button"
                  role="switch"
                  [attr.aria-checked]="preferencias().notificacionesEmail">
                  <span class="configuracion__toggle-circulo"></span>
                </button>
              </article>

              <article class="configuracion__toggle-item">
                <hgroup class="configuracion__toggle-info">
                  <h3 class="configuracion__toggle-titulo">Notificaciones push</h3>
                  <p class="configuracion__toggle-descripcion">Recibe alertas en tu dispositivo</p>
                </hgroup>
                <button
                  (click)="togglePreferencia('notificacionesPush')"
                  [class.configuracion__toggle--activo]="preferencias().notificacionesPush"
                  class="configuracion__toggle"
                  type="button"
                  role="switch"
                  [attr.aria-checked]="preferencias().notificacionesPush">
                  <span class="configuracion__toggle-circulo"></span>
                </button>
              </article>
            </fieldset>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Recordatorios</legend>

              <article class="configuracion__toggle-item">
                <hgroup class="configuracion__toggle-info">
                  <h3 class="configuracion__toggle-titulo">Recordatorios de entrenamiento</h3>
                  <p class="configuracion__toggle-descripcion">Te avisamos cuando sea hora de entrenar</p>
                </hgroup>
                <button
                  (click)="togglePreferencia('recordatoriosEntrenamiento')"
                  [class.configuracion__toggle--activo]="preferencias().recordatoriosEntrenamiento"
                  class="configuracion__toggle"
                  type="button"
                  role="switch"
                  [attr.aria-checked]="preferencias().recordatoriosEntrenamiento">
                  <span class="configuracion__toggle-circulo"></span>
                </button>
              </article>

              <article class="configuracion__toggle-item">
                <hgroup class="configuracion__toggle-info">
                  <h3 class="configuracion__toggle-titulo">Recordatorios de comidas</h3>
                  <p class="configuracion__toggle-descripcion">Te recordamos registrar tus comidas</p>
                </hgroup>
                <button
                  (click)="togglePreferencia('recordatoriosComidas')"
                  [class.configuracion__toggle--activo]="preferencias().recordatoriosComidas"
                  class="configuracion__toggle"
                  type="button"
                  role="switch"
                  [attr.aria-checked]="preferencias().recordatoriosComidas">
                  <span class="configuracion__toggle-circulo"></span>
                </button>
              </article>
            </fieldset>
          </section>
        }

        @case ('privacidad') {
          <section class="configuracion__seccion">
            <h2 class="configuracion__seccion-titulo">Privacidad y Datos</h2>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Gestión de Datos</legend>

              <article class="configuracion__accion-item">
                <hgroup class="configuracion__accion-info">
                  <h3 class="configuracion__accion-titulo">Exportar mis datos</h3>
                  <p class="configuracion__accion-descripcion">Descarga una copia de toda tu información</p>
                </hgroup>
                <app-button (click)="exportarDatos()" tamanio="pequeno" variante="secundario">
                  Exportar
                </app-button>
              </article>
            </fieldset>

            <fieldset class="configuracion__grupo">
              <legend class="configuracion__grupo-titulo">Documentos Legales</legend>

              <nav class="configuracion__enlaces">
                <a class="configuracion__enlace" routerLink="/privacidad">
                  <span>Política de privacidad</span>
                  <svg aria-hidden="true" class="configuracion__enlace-icono" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
                <a class="configuracion__enlace" routerLink="/terminos">
                  <span>Términos y condiciones</span>
                  <svg aria-hidden="true" class="configuracion__enlace-icono" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
                <a class="configuracion__enlace" routerLink="/cookies">
                  <span>Política de cookies</span>
                  <svg aria-hidden="true" class="configuracion__enlace-icono" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              </nav>
            </fieldset>
          </section>
        }

        @case ('suscripcion') {
          <section class="configuracion__seccion">
            <h2 class="configuracion__seccion-titulo">Suscripción</h2>

            @if (esPro()) {
              <fieldset class="configuracion__grupo configuracion__grupo--pro">
                <legend class="configuracion__grupo-titulo">
                  <mark class="configuracion__badge-pro">PRO</mark>
                  Estado de tu Suscripción
                </legend>

                <article class="configuracion__suscripcion-info">
                  <section class="configuracion__suscripcion-detalle">
                    <span class="configuracion__suscripcion-etiqueta">Estado</span>
                    <span class="configuracion__suscripcion-valor configuracion__suscripcion-valor--activa">
                      @switch (suscripcionActual()?.estadoSuscripcion) {
                        @case ('activa') { Activa }
                        @case ('periodo_gracia') { Período de gracia }
                        @case ('cancelada') { Cancelada }
                        @default { -- }
                      }
                    </span>
                  </section>

                  <section class="configuracion__suscripcion-detalle">
                    <span class="configuracion__suscripcion-etiqueta">Fecha de inicio</span>
                    <span class="configuracion__suscripcion-valor">
                      {{ formatearFechaSuscripcion(suscripcionActual()?.fechaInicio || '') }}
                    </span>
                  </section>

                  <section class="configuracion__suscripcion-detalle">
                    <span class="configuracion__suscripcion-etiqueta">Próxima renovación</span>
                    <span class="configuracion__suscripcion-valor">
                      {{ formatearFechaSuscripcion(suscripcionActual()?.fechaExpiracion || '') }}
                    </span>
                  </section>

                  <section class="configuracion__suscripcion-detalle">
                    <span class="configuracion__suscripcion-etiqueta">Días restantes</span>
                    <span class="configuracion__suscripcion-valor">
                      {{ diasRestantes() }} días
                    </span>
                  </section>
                </article>
              </fieldset>

              <fieldset class="configuracion__grupo">
                <legend class="configuracion__grupo-titulo">Opciones de Renovación</legend>

                <article class="configuracion__toggle-item">
                  <hgroup class="configuracion__toggle-info">
                    <h3 class="configuracion__toggle-titulo">Renovación automática</h3>
                    <p class="configuracion__toggle-descripcion">
                      Tu suscripción se renovará automáticamente cada mes
                    </p>
                  </hgroup>
                  <button
                    (click)="toggleRenovacionAutomatica()"
                    [class.configuracion__toggle--activo]="renovacionAutomatica()"
                    [disabled]="cargandoSuscripcion()"
                    class="configuracion__toggle"
                    type="button"
                    role="switch"
                    [attr.aria-checked]="renovacionAutomatica()">
                    <span class="configuracion__toggle-circulo"></span>
                  </button>
                </article>
              </fieldset>

              <fieldset class="configuracion__grupo configuracion__grupo--peligro">
                <legend class="configuracion__grupo-titulo configuracion__grupo-titulo--peligro">Cancelar Suscripción</legend>

                <article class="configuracion__accion-item configuracion__accion-item--peligro">
                  <hgroup class="configuracion__accion-info">
                    <h3 class="configuracion__accion-titulo">Cancelar PRO</h3>
                    <p class="configuracion__accion-descripcion">
                      Mantendrás acceso hasta que expire tu período actual
                    </p>
                  </hgroup>
                  <app-button
                    (click)="cancelarSuscripcion()"
                    [habilitado]="cargandoSuscripcion()"
                    tamanio="pequeno"
                    variante="peligro">
                    @if (cargandoSuscripcion()) {
                      Cancelando...
                    } @else {
                      Cancelar
                    }
                  </app-button>
                </article>
              </fieldset>
            } @else {
              <fieldset class="configuracion__grupo">
                <legend class="configuracion__grupo-titulo">Activa Cofira PRO</legend>

                <article class="configuracion__suscripcion-promo">
                  <figure class="configuracion__suscripcion-icono">
                    <svg aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                      <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </figure>
                  <hgroup class="configuracion__suscripcion-promo-info">
                    <h3 class="configuracion__suscripcion-promo-titulo">Desbloquea todo el potencial</h3>
                    <ul class="configuracion__suscripcion-beneficios">
                      <li>Gimnasio personalizado</li>
                      <li>Planes de alimentación</li>
                      <li>Seguimiento de progreso</li>
                    </ul>
                    <p class="configuracion__suscripcion-precio">
                      <strong>9.99€</strong>/mes
                    </p>
                  </hgroup>
                  <app-button (click)="activarPro()" tamanio="mediano" variante="primario">
                    Activar PRO
                  </app-button>
                </article>
              </fieldset>
            }
          </section>
        }

        @case ('cuenta') {
          <section class="configuracion__seccion">
            <h2 class="configuracion__seccion-titulo">Gestión de Cuenta</h2>

            <fieldset class="configuracion__grupo configuracion__grupo--peligro">
              <legend class="configuracion__grupo-titulo configuracion__grupo-titulo--peligro">Zona de Peligro</legend>

              <article class="configuracion__accion-item configuracion__accion-item--peligro">
                <hgroup class="configuracion__accion-info">
                  <h3 class="configuracion__accion-titulo">Eliminar cuenta</h3>
                  <p class="configuracion__accion-descripcion">Esta acción es irreversible. Se eliminarán todos tus datos.</p>
                </hgroup>
                <app-button (click)="eliminarCuenta()" tamanio="pequeno" variante="peligro">
                  Eliminar
                </app-button>
              </article>
            </fieldset>
          </section>
        }
      }

      <footer class="configuracion__footer">
        <app-button (click)="guardarPreferencias()" [habilitado]="estaCargando()" tamanio="mediano" variante="primario">
          @if (estaCargando()) {
            Guardando...
          } @else {
            Guardar cambios
          }
        </app-button>
      </footer>
    </article>
  </section>
</main>
