<main class="gimnasio">

  <header class="gimnasio__cabecera">
    <h1 class="gimnasio__titulo">TABLA SEMANAL</h1>
  </header>

  @if (isLoading()) {
    <section class="gimnasio__estado">
      <p class="gimnasio__estado-texto">Cargando tu rutina...</p>
    </section>
  }

  @if (error()) {
    <section class="gimnasio__estado gimnasio__estado--error">
      <p class="gimnasio__estado-texto">{{ error() }}</p>
    </section>
  }

  @if (!tieneRutina() && !isLoading() && !error()) {
    <section class="gimnasio__estado">
      <p class="gimnasio__estado-texto">Tu rutina se está preparando</p>
      <p class="gimnasio__estado-subtexto">Las rutinas se generan automáticamente cada mes. Tu nueva rutina estará lista pronto.</p>
    </section>
  }

  @if (tieneRutina() && !isLoading()) {
  <nav aria-label="Navegación de días" class="gimnasio__dias">
    <button (click)="diaAnterior()" aria-label="Día anterior" class="gimnasio__dias-btn">
      <svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor" />
      </svg>
    </button>

    <span class="gimnasio__dia gimnasio__dia--adyacente">
      {{ diasSemana[diaActualIndex() - 1] || '' }}
    </span>

    <h2 class="gimnasio__dia gimnasio__dia--actual">
      {{ diasSemana[diaActualIndex()] }}
    </h2>

    <span class="gimnasio__dia gimnasio__dia--adyacente">
      {{ diasSemana[diaActualIndex() + 1] || '' }}
    </span>

    <button (click)="diaSiguiente()" aria-label="Día siguiente" class="gimnasio__dias-btn">
      <svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" fill="currentColor" />
      </svg>
    </button>
  </nav>

  <section class="gimnasio__tabla-section gimnasio__tabla-section--escritorio">
    <table class="gimnasio__tabla">
      <thead>
        <tr>
          <th class="gimnasio__tabla-cabecera">Ejercicio</th>
          <th class="gimnasio__tabla-cabecera">Repeticiones</th>
          <th class="gimnasio__tabla-cabecera">Descanso</th>
          <th class="gimnasio__tabla-cabecera">Series</th>
          <th class="gimnasio__tabla-cabecera">Peso (kg)</th>
          <th class="gimnasio__tabla-cabecera">Realizado</th>
        </tr>
      </thead>
      <tbody>
        @if (ejerciciosDelDia().length > 0) {
          @for (ejercicio of ejerciciosDelDia(); track ejercicio.id) {
          <tr class="gimnasio__tabla-fila">
            <td class="gimnasio__ejercicio gimnasio__tabla-dato">
              <button (click)="toggleEjercicio(ejercicio)" [attr.aria-expanded]="ejercicio.expandido" aria-label="Expandir ejercicio"
                class="gimnasio__ejercicio-toggle">
                <svg aria-hidden="true" class="gimnasio__ejercicio-toggle-svg" [class.gimnasio__ejercicio-toggle-svg--rotado]="ejercicio.expandido" viewBox="0 0 24 24">
                  <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" fill="currentColor" />
                </svg>
              </button>
              {{ ejercicio.nombre }}
            </td>
            <td class="gimnasio__tabla-dato">{{ ejercicio.repeticiones }}</td>
            <td class="gimnasio__tabla-dato">{{ ejercicio.descanso }}</td>
            <td class="gimnasio__tabla-dato">{{ ejercicio.series }}</td>
            <td class="gimnasio__tabla-dato">
              <input
                type="number"
                [value]="ejercicio.pesoKg || ''"
                (change)="actualizarPeso(ejercicio, $event)"
                class="gimnasio__input-peso"
                placeholder="0"
                min="0"
                max="500"
                step="0.5"
                aria-label="Peso en kilogramos">
            </td>
            <td class="gimnasio__acciones gimnasio__tabla-dato">
              <button (click)="marcarRealizado(ejercicio, true)" [class.gimnasio__btn-accion--activo]="ejercicio.realizado === true"
                aria-label="Marcar como realizado" class="gimnasio__btn-accion gimnasio__btn-accion--ok">
                <svg aria-hidden="true" class="gimnasio__btn-accion-svg" viewBox="0 0 24 24">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor" />
                </svg>
              </button>
              <button (click)="marcarRealizado(ejercicio, false)" [class.gimnasio__btn-accion--activo]="ejercicio.realizado === false"
                aria-label="Marcar como no realizado" class="gimnasio__btn-accion gimnasio__btn-accion--no">
                <svg aria-hidden="true" class="gimnasio__btn-accion-svg" viewBox="0 0 24 24">
                  <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                    fill="currentColor" />
                </svg>
              </button>
            </td>
          </tr>
          }
        } @else {
          <tr>
            <td colspan="6" class="gimnasio__sin-ejercicios">
              <p class="gimnasio__sin-ejercicios-titulo">Dia de descanso</p>
              <span class="gimnasio__sin-ejercicios-subtitulo">No hay ejercicios programados para este dia</span>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </section>

  <section class="gimnasio__acordeon gimnasio__acordeon--movil">
    @if (ejerciciosDelDia().length > 0) {
      @for (ejercicio of ejerciciosDelDia(); track ejercicio.id) {
      <article class="gimnasio__acordeon-item" [class.gimnasio__acordeon-item--expandido]="ejercicio.expandido">
        <header class="gimnasio__acordeon-header" (click)="toggleEjercicio(ejercicio)">
          <hgroup class="gimnasio__acordeon-info">
            <button [attr.aria-expanded]="ejercicio.expandido" aria-label="Expandir ejercicio" class="gimnasio__acordeon-toggle">
              <svg aria-hidden="true" class="gimnasio__acordeon-toggle-svg" [class.gimnasio__acordeon-toggle-svg--rotado]="ejercicio.expandido" viewBox="0 0 24 24">
                <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" fill="currentColor" />
              </svg>
            </button>
            <span class="gimnasio__acordeon-nombre">{{ ejercicio.nombre }}</span>
          </hgroup>
          <menu class="gimnasio__acordeon-acciones">
            <li class="gimnasio__acordeon-acciones-item">
              <button (click)="marcarRealizado(ejercicio, true); $event.stopPropagation()"
                [class.gimnasio__btn-accion--activo]="ejercicio.realizado === true" aria-label="Marcar como realizado"
                class="gimnasio__btn-accion gimnasio__btn-accion--ok gimnasio__btn-accion--acordeon">
                <svg aria-hidden="true" class="gimnasio__btn-accion-svg" viewBox="0 0 24 24">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor" />
                </svg>
              </button>
            </li>
            <li class="gimnasio__acordeon-acciones-item">
              <button (click)="marcarRealizado(ejercicio, false); $event.stopPropagation()"
                [class.gimnasio__btn-accion--activo]="ejercicio.realizado === false" aria-label="Marcar como no realizado"
                class="gimnasio__btn-accion gimnasio__btn-accion--no gimnasio__btn-accion--acordeon">
                <svg aria-hidden="true" class="gimnasio__btn-accion-svg" viewBox="0 0 24 24">
                  <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                    fill="currentColor" />
                </svg>
              </button>
            </li>
          </menu>
        </header>

        <section class="gimnasio__acordeon-contenido" [class.gimnasio__acordeon-contenido--expandido]="ejercicio.expandido">
          <dl class="gimnasio__acordeon-detalles">
            <dt class="gimnasio__acordeon-label">Repeticiones</dt>
            <dd class="gimnasio__acordeon-valor">{{ ejercicio.repeticiones }}</dd>
            <dt class="gimnasio__acordeon-label">Descanso</dt>
            <dd class="gimnasio__acordeon-valor">{{ ejercicio.descanso }}</dd>
            <dt class="gimnasio__acordeon-label">Series</dt>
            <dd class="gimnasio__acordeon-valor">{{ ejercicio.series }}</dd>
            <dt class="gimnasio__acordeon-label">Peso (kg)</dt>
            <dd class="gimnasio__acordeon-valor">
              <input
                type="number"
                [value]="ejercicio.pesoKg || ''"
                (change)="actualizarPeso(ejercicio, $event)"
                class="gimnasio__input-peso gimnasio__input-peso--acordeon"
                placeholder="0"
                min="0"
                max="500"
                step="0.5"
                aria-label="Peso en kilogramos">
            </dd>
          </dl>
        </section>
      </article>
      }
    } @else {
      <article class="gimnasio__sin-ejercicios gimnasio__sin-ejercicios--acordeon">
        <p class="gimnasio__sin-ejercicios-titulo">Dia de descanso</p>
        <span class="gimnasio__sin-ejercicios-subtitulo">No hay ejercicios programados para este dia</span>
      </article>
    }
  </section>

  <section class="gimnasio__feedback">
    <h2 class="gimnasio__feedback-titulo">Retroalimentación</h2>

    <form (ngSubmit)="enviarFeedback()" class="gimnasio__feedback-form">
      <fieldset class="gimnasio__feedback-field">
        <label class="gimnasio__feedback-label" for="ejercicios-dificiles">
          ¿Cuáles son los ejercicios que más te han costado?
        </label>
        <textarea [(ngModel)]="feedback.ejerciciosDificiles" class="gimnasio__feedback-textarea"
          id="ejercicios-dificiles" name="ejerciciosDificiles"
          placeholder="Escribe aquellos ejercicios que te hayan costado y los posibles motivos..." rows="4">
        </textarea>
      </fieldset>

      <fieldset class="gimnasio__feedback-field">
        <label class="gimnasio__feedback-label gimnasio__feedback-label--checkbox">
          <input type="checkbox" [(ngModel)]="feedback.puedeMasPeso" name="puedeMasPeso"
            class="gimnasio__feedback-checkbox">
          <span>¿Crees que podrías con más peso?</span>
        </label>
      </fieldset>

      <fieldset class="gimnasio__feedback-field">
        <label class="gimnasio__feedback-label" for="comentarios">
          Comentarios adicionales
        </label>
        <textarea [(ngModel)]="feedback.comentarios" class="gimnasio__feedback-textarea" id="comentarios" name="comentarios"
          placeholder="Escribe cualquier comentario adicional sobre tu entrenamiento esta semana..."
          rows="4">
        </textarea>
      </fieldset>

      <footer class="gimnasio__feedback-acciones">
        <app-button (click)="cancelarFeedback()" tamanio="mediano" tipo="button" variante="secundario">
          Cancelar
        </app-button>
        <app-button tamanio="mediano" tipo="submit" variante="primario">
          Enviar
        </app-button>
      </footer>
    </form>
  </section>

  <section class="gimnasio__progreso">
    <article class="gimnasio__progreso-contenido">
      <header class="gimnasio__progreso-panel">
        <h2 class="gimnasio__progreso-titulo">Ver mi progreso</h2>
        <p class="gimnasio__progreso-descripcion">
          ¿Quieres ver tu progreso y cómo has evolucionado durante toda tu estancia en Cofira?
        </p>
        <app-button enlace="/seguimiento" tamanio="grande" variante="primario" id="gimnasio__progreso-boton">
          Ver estadísticas
        </app-button>
      </header>
      <figure class="gimnasio__progreso-imagen">
        <picture class="gimnasio__progreso-imagen-contenedor">
          <source
            media="(max-width: 900px)"
            type="image/webp"
            srcset="
              assets/images/imagen_progreso_mobile-400w.webp 400w,
              assets/images/imagen_progreso_mobile-600w.webp 600w,
              assets/images/imagen_progreso_mobile-900w.webp 900w"
            sizes="(max-width: 600px) 100vw, 80vw" />
          <source
            type="image/webp"
            srcset="
              assets/images/imagen_progreso-600w.webp 600w,
              assets/images/imagen_progreso-900w.webp 900w,
              assets/images/imagen_progreso-1200w.webp 1200w"
            sizes="(max-width: 1200px) 50vw, 600px" />
          <img
            class="gimnasio__progreso-imagen-foto"
            alt="Persona entrenando en el gimnasio"
            loading="lazy"
            src="assets/images/imagen_progreso.jpg"
            width="1200"
            height="800" />
        </picture>
      </figure>
    </article>
  </section>
  }

</main>
