<main class="perfil">
  <header class="perfil__cabecera">
    <h1 class="perfil__titulo">Mi Perfil</h1>
    <p class="perfil__subtitulo">Gestiona tu información personal y preferencias</p>
  </header>

  <section class="perfil__contenido">
    <article class="perfil__tarjeta perfil__tarjeta--info">
      <header class="perfil__tarjeta-cabecera">
        <h2 class="perfil__tarjeta-titulo">Información Personal</h2>
        @if (!modoEdicion()) {
          <button (click)="activarEdicion()" class="perfil__btn-editar" type="button">
            <svg aria-hidden="true" class="perfil__btn-editar-icono" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Editar</span>
          </button>
        }
      </header>

      <form class="perfil__formulario">
        <fieldset class="perfil__campo">
          <label class="perfil__etiqueta" for="nombre">Nombre</label>
          @if (modoEdicion()) {
            <input
              [(ngModel)]="datosUsuario().nombre"
              class="perfil__input"
              id="nombre"
              name="nombre"
              placeholder="Tu nombre"
              type="text">
          } @else {
            <p class="perfil__valor">{{ datosUsuario().nombre || 'No especificado' }}</p>
          }
        </fieldset>

        <fieldset class="perfil__campo">
          <label class="perfil__etiqueta" for="email">Correo electrónico</label>
          <p class="perfil__valor perfil__valor--email">{{ datosUsuario().email }}</p>
        </fieldset>

        <fieldset class="perfil__campo">
          <label class="perfil__etiqueta">Miembro desde</label>
          <p class="perfil__valor">{{ formatearFecha(datosUsuario().fechaRegistro) }}</p>
        </fieldset>

        @if (modoEdicion()) {
          <footer class="perfil__acciones">
            <app-button (click)="cancelarEdicion()" tamanio="mediano" tipo="button" variante="secundario">
              Cancelar
            </app-button>
            <app-button (click)="guardarCambios()" [habilitado]="estaCargando()" tamanio="mediano" tipo="button" variante="primario">
              @if (estaCargando()) {
                Guardando...
              } @else {
                Guardar cambios
              }
            </app-button>
          </footer>
        }
      </form>
    </article>

    <article class="perfil__tarjeta perfil__tarjeta--salud">
      <header class="perfil__tarjeta-cabecera">
        <h2 class="perfil__tarjeta-titulo">Datos de Salud</h2>
      </header>

      <section class="perfil__salud-grid">
        <article class="perfil__salud-item">
          <span class="perfil__salud-etiqueta">Peso actual</span>
          <span class="perfil__salud-valor">
            @if (datosUsuario().peso) {
              {{ datosUsuario().peso }} kg
            } @else {
              --
            }
          </span>
        </article>

        <article class="perfil__salud-item">
          <span class="perfil__salud-etiqueta">Altura</span>
          <span class="perfil__salud-valor">
            @if (datosUsuario().altura) {
              {{ datosUsuario().altura }} cm
            } @else {
              --
            }
          </span>
        </article>

        <article class="perfil__salud-item">
          <span class="perfil__salud-etiqueta">IMC</span>
          <span class="perfil__salud-valor">
            @if (imcCalculado()) {
              {{ imcCalculado() }}
              @if (estadoImc()) {
                <mark class="perfil__imc-estado perfil__imc-estado--{{ estadoImc()?.clase }}">
                  {{ estadoImc()?.texto }}
                </mark>
              }
            } @else {
              --
            }
          </span>
        </article>

        <article class="perfil__salud-item">
          <span class="perfil__salud-etiqueta">Objetivo</span>
          <span class="perfil__salud-valor">{{ datosUsuario().objetivo }}</span>
        </article>
      </section>
    </article>

    <article class="perfil__tarjeta perfil__tarjeta--actividad">
      <header class="perfil__tarjeta-cabecera">
        <h2 class="perfil__tarjeta-titulo">Nivel de Actividad</h2>
      </header>

      <section class="perfil__actividad">
        <figure class="perfil__actividad-icono">
          <svg aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.631 8.41m5.96 5.96a14.926 14.926 0 01-5.841 2.58m-.119-8.54a6 6 0 00-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 00-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 01-2.448-2.448 14.9 14.9 0 01.06-.312m-2.24 2.39a4.493 4.493 0 00-1.757 4.306 4.493 4.493 0 004.306-1.758M16.5 9a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </figure>
        <hgroup class="perfil__actividad-info">
          <h3 class="perfil__actividad-nivel">{{ datosUsuario().nivelActividad }}</h3>
          <p class="perfil__actividad-descripcion">
            @switch (datosUsuario().nivelActividad) {
              @case ('Sedentario') {
                Poco o ningún ejercicio
              }
              @case ('Ligero') {
                Ejercicio ligero 1-3 días/semana
              }
              @case ('Moderado') {
                Ejercicio moderado 3-5 días/semana
              }
              @case ('Activo') {
                Ejercicio intenso 6-7 días/semana
              }
              @case ('Muy activo') {
                Ejercicio muy intenso o trabajo físico
              }
              @default {
                Nivel de actividad personalizado
              }
            }
          </p>
        </hgroup>
      </section>
    </article>
  </section>
</main>
