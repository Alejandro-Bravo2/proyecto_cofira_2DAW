<article class="step-register">

  <header class="step-register__header">
    <h2 class="step-register__titulo">Crea tu cuenta</h2>
    <p class="step-register__subtitulo">
      Guarda tu plan personalizado y accede desde cualquier dispositivo
    </p>
  </header>

  <form (ngSubmit)="alEnviar()" [formGroup]="formularioRegistro" class="step-register__form">
    <fieldset class="step-register__fieldset">

      
      <label class="step-register__field">
        <span class="step-register__field-icon">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
        </span>
        <input
          autocomplete="name"
          class="step-register__input"
          formControlName="nombre"
          placeholder="Tu nombre"
          type="text">
      </label>

      
      <label class="step-register__field">
        <span class="step-register__field-icon">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
        </span>
        <input
          [class.step-register__input--error]="estadoEmail === 'invalid-format' || estadoEmail === 'taken'"
          [class.step-register__input--valid]="estadoEmail === 'valid'"
          autocomplete="email"
          class="step-register__input"
          formControlName="email"
          placeholder="tu@email.com"
          type="email">
        @if (estadoEmail === 'checking') {
          <span class="step-register__field-status step-register__field-status--loading">
            <svg class="step-register__spinner" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 12a8 8 0 018-8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        }
        @if (estadoEmail === 'valid') {
          <span class="step-register__field-status step-register__field-status--valid">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4.5 12.75l6 6 9-13.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        }
      </label>

      
      @if (estadoEmail === 'invalid-format') {
        <aside class="step-register__field-error">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
          <span>El email debe tener un formato valido. Ejemplos: usuario&#64;gmail.com, nombre&#64;empresa.es</span>
        </aside>
      }
      @if (estadoEmail === 'taken') {
        <aside class="step-register__field-error">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
          <span>Este email ya esta registrado. <a class="step-register__link"
                                                  routerLink="/login">¿Iniciar sesion?</a></span>
        </aside>
      }

      
      <label class="step-register__field">
        <span class="step-register__field-icon">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
        </span>
        <input
          [type]="mostrarContrasena() ? 'text' : 'password'"
          autocomplete="new-password"
          class="step-register__input step-register__input--password"
          formControlName="password"
          placeholder="Crea tu contraseña">
        <button (click)="alternarContrasena()" class="step-register__toggle-password" type="button">
          @if (mostrarContrasena()) {
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" stroke-linecap="round"
                    stroke-linejoin="round"/>
            </svg>
          } @else {
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" stroke-linecap="round"
                    stroke-linejoin="round"/>
              <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          }
        </button>
      </label>

      
      @if (valorContrasena.length > 0) {
        <aside class="step-register__requirements">
          <ul class="step-register__requirements-list">
            <li [class.step-register__requirement--valid]="requisitosContrasena.isLongEnough"
                class="step-register__requirement">
              <svg class="step-register__requirement-icon" fill="currentColor" viewBox="0 0 20 20">
                @if (requisitosContrasena.isLongEnough) {
                  <path clip-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        fill-rule="evenodd"/>
                } @else {
                  <path clip-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        fill-rule="evenodd"/>
                }
              </svg>
              <span>8 caracteres</span>
            </li>
            <li [class.step-register__requirement--valid]="requisitosContrasena.hasUpperCase"
                class="step-register__requirement">
              <svg class="step-register__requirement-icon" fill="currentColor" viewBox="0 0 20 20">
                @if (requisitosContrasena.hasUpperCase) {
                  <path clip-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        fill-rule="evenodd"/>
                } @else {
                  <path clip-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        fill-rule="evenodd"/>
                }
              </svg>
              <span>1 mayuscula</span>
            </li>
            <li [class.step-register__requirement--valid]="requisitosContrasena.hasLowerCase"
                class="step-register__requirement">
              <svg class="step-register__requirement-icon" fill="currentColor" viewBox="0 0 20 20">
                @if (requisitosContrasena.hasLowerCase) {
                  <path clip-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        fill-rule="evenodd"/>
                } @else {
                  <path clip-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        fill-rule="evenodd"/>
                }
              </svg>
              <span>1 minuscula</span>
            </li>
            <li [class.step-register__requirement--valid]="requisitosContrasena.hasNumeric"
                class="step-register__requirement">
              <svg class="step-register__requirement-icon" fill="currentColor" viewBox="0 0 20 20">
                @if (requisitosContrasena.hasNumeric) {
                  <path clip-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        fill-rule="evenodd"/>
                } @else {
                  <path clip-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        fill-rule="evenodd"/>
                }
              </svg>
              <span>1 numero</span>
            </li>
            <li [class.step-register__requirement--valid]="requisitosContrasena.hasSpecial"
                class="step-register__requirement">
              <svg class="step-register__requirement-icon" fill="currentColor" viewBox="0 0 20 20">
                @if (requisitosContrasena.hasSpecial) {
                  <path clip-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        fill-rule="evenodd"/>
                } @else {
                  <path clip-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        fill-rule="evenodd"/>
                }
              </svg>
              <span>1 caracter especial (!@#$...)</span>
            </li>
          </ul>
        </aside>
      }

      
      <label class="step-register__field">
        <span class="step-register__field-icon">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" stroke-linecap="round"
                  stroke-linejoin="round"/>
          </svg>
        </span>
        <input
          [type]="mostrarConfirmacionContrasena() ? 'text' : 'password'"
          autocomplete="new-password"
          class="step-register__input step-register__input--password"
          formControlName="confirmPassword"
          placeholder="Repite tu contraseña">
        <button (click)="alternarConfirmacionContrasena()" class="step-register__toggle-password" type="button">
          @if (mostrarConfirmacionContrasena()) {
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" stroke-linecap="round"
                    stroke-linejoin="round"/>
            </svg>
          } @else {
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" stroke-linecap="round"
                    stroke-linejoin="round"/>
              <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          }
        </button>
      </label>

    </fieldset>

    @if (!contrasenasCoinciden() && formularioRegistro.get('confirmPassword')?.touched) {
      <aside class="step-register__error">
        <svg class="step-register__error-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" stroke-linecap="round"
                stroke-linejoin="round"/>
        </svg>
        <p class="step-register__error-text">Las contraseñas no coinciden</p>
      </aside>
    }

    @if (error()) {
      <aside class="step-register__error">
        <svg class="step-register__error-icono" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" stroke-linecap="round"
                stroke-linejoin="round"/>
        </svg>
        <p class="step-register__error-text">{{ error() }}</p>
      </aside>
    }

    <footer class="step-register__footer">
      <app-button
        [habilitado]="!puedeEnviar()"
        tamanio="grande"
        tipo="submit"
        variante="primario">
        @if (estaCargando()) {
          <span class="step-register__loading">
            <svg class="step-register__spinner" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 12a8 8 0 018-8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Creando cuenta...
          </span>
        } @else {
          Crear cuenta
        }
      </app-button>

      <p class="step-register__alt-action">
        ¿Ya tienes cuenta?
        <a class="step-register__link" routerLink="/login">Iniciar sesión</a>
      </p>
    </footer>
  </form>

</article>
