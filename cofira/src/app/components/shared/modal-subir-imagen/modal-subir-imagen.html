<app-modal
  (cerrar)="cerrarModal()"
  [abierto]="abierto"
  [anchoPX]="500"
  titulo="Analizar comida con IA">

  <section class="modal-imagen">
    @if (comida) {
      <p class="modal-imagen__subtitulo">
        Sube una foto de lo que comiste en lugar de: <strong>{{ comida.nombre }}</strong>
      </p>
    }

    <input
      #inputArchivo
      (change)="manejarSeleccionArchivo($event)"
      accept="image/*"
      class="modal-imagen__input-oculto"
      type="file">

    @if (!imagenPreview) {
      <button
        (click)="seleccionarArchivo()"
        class="modal-imagen__zona-subida"
        type="button">
        <svg aria-hidden="true" class="modal-imagen__icono-subida" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z" fill="currentColor"/>
        </svg>
        <span class="modal-imagen__texto-subida">Haz clic para seleccionar una imagen</span>
        <span class="modal-imagen__texto-formatos">JPG, PNG, WEBP</span>
      </button>
    } @else {
      <figure class="modal-imagen__preview">
        <img [src]="imagenPreview" alt="Preview de la comida" class="modal-imagen__preview-img">
        <button
          (click)="seleccionarArchivo()"
          class="modal-imagen__btn-cambiar"
          type="button">
          Cambiar imagen
        </button>
      </figure>
    }

    @if (imagenPreview && !analisisCompletado) {
      <button
        (click)="analizarImagen()"
        [disabled]="analizando"
        class="modal-imagen__btn-analizar"
        type="button">
        @if (analizando) {
          <figure class="modal-imagen__spinner"></figure>
          Analizando...
        } @else {
          <svg aria-hidden="true" class="modal-imagen__btn-analizar-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" fill="currentColor"/>
          </svg>
          Analizar con IA
        }
      </button>
    }

    @if (analisisCompletado) {
      <article class="modal-imagen__resultados">
        <h3 class="modal-imagen__resultados-titulo">Análisis completado</h3>
        <p class="modal-imagen__resultado-nombre">{{ resultadoAnalisis.nombreComida }}</p>

        <ul class="modal-imagen__macros">
          <li class="modal-imagen__macro">
            <span class="modal-imagen__macro-label">Calorías</span>
            <span class="modal-imagen__macro-valor">{{ resultadoAnalisis.calorias }} kcal</span>
          </li>
          <li class="modal-imagen__macro">
            <span class="modal-imagen__macro-label">Proteínas</span>
            <span class="modal-imagen__macro-valor">{{ resultadoAnalisis.proteinas }}g</span>
          </li>
          <li class="modal-imagen__macro">
            <span class="modal-imagen__macro-label">Carbohidratos</span>
            <span class="modal-imagen__macro-valor">{{ resultadoAnalisis.carbohidratos }}g</span>
          </li>
          <li class="modal-imagen__macro">
            <span class="modal-imagen__macro-label">Grasas</span>
            <span class="modal-imagen__macro-valor">{{ resultadoAnalisis.grasas }}g</span>
          </li>
        </ul>

        <p class="modal-imagen__confianza modal-imagen__confianza--{{ resultadoAnalisis.confianza }}">
          Confianza: {{ resultadoAnalisis.confianza }}
        </p>
      </article>
    }

    <footer class="modal-imagen__acciones">
      <button
        (click)="cerrarModal()"
        class="modal-imagen__btn modal-imagen__btn--cancelar"
        type="button">
        Cancelar
      </button>
      @if (analisisCompletado) {
        <button
          (click)="guardarResultado()"
          [disabled]="guardando"
          class="modal-imagen__btn modal-imagen__btn--guardar"
          type="button">
          @if (guardando) {
            <figure class="modal-imagen__spinner"></figure>
            Guardando...
          } @else {
            Guardar resultado
          }
        </button>
      }
    </footer>
  </section>

</app-modal>
